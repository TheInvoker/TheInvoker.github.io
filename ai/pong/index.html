 <!DOCTYPE html>
<html>
	<head>
		<title>Sender</title>

		<style>

		</style>
	</head>

	<body>
		<script src="synaptic.min.js"></script>
		
		<script>
			var totalTrainingItems = 0;
			
			var learningRate = .3;
			var Neuron = synaptic.Neuron;
			var Layer = synaptic.Layer;
			var Network = synaptic.Network;
			
			// create the network
			var inputLayer = new Layer(2);
			var hiddenLayer = new Layer(3);
			var hiddenLayer2 = new Layer(3);
			var outputLayer = new Layer(1);

			inputLayer.project(hiddenLayer);
			hiddenLayer.project(hiddenLayer2);
			hiddenLayer2.project(outputLayer);

			var myNetwork = new Network({
				input: inputLayer,
				hidden: [hiddenLayer, hiddenLayer2],
				output: outputLayer
			});
			
			hiddenLayer.neurons().map(function(x) { x.squash = Neuron.squash.RELU; });
			hiddenLayer2.neurons().map(function(x) { x.squash = Neuron.squash.RELU; });
			
			function receiveMessage(event) {
				if (event.data.id == 0) {
				    totalTrainingItems += event.data.message.length;
				    document.getElementById("totalItems").innerHTML = totalTrainingItems;
					
				    for(var i=0; i<event.data.message.length; i+=1) {
					var item = event.data.message[i];
				    	myNetwork.activate([item[0], item[1]]);
				    	myNetwork.propagate(learningRate, [item[2]]);
				    }
				} else if (event.data.id == 1) {
				    event.source.postMessage({'id':1, 'message':myNetwork.toJSON()}, "https://theinvoker.github.io");
				}
			}
			window.addEventListener("message", receiveMessage, false);
			
			function newPopup() {
				var popup = window.open('./pong.html', '_blank', 'location=yes,height=362,width=439,scrollbars=yes,status=yes');

				popup.addEventListener('load', function() {
				    popup.postMessage({'id':0, 'message':myNetwork.toJSON()}, "https://theinvoker.github.io");
				}, true); 
			}
			
			newPopup();

		</script>
		
		Total Training Size
		<div id="totalItems">0</div>
		<button id="spawnnew" onclick="newPopup();">Spawn AI Trainer</button>
		
	</body>

</html> 
